
<!DOCTYPE html>
<html lang="en">
  <head>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/leaflet.css"/>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/leaflet.js"></script>  
    <script type="text/javascript" src="selected_countries.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/webfont/1.6.26/webfont.js" type="text/javascript"></script><script type="text/javascript">WebFont.load({  google: {    families: ["Montserrat:100,100italic,200,200italic,300,300italic,400,400italic,500,500italic,600,600italic,700,700italic,800,800italic,900,900italic"]  }});</script>
 
  </head>

<style>
body {
  font-family: 'Montserrat', 'sans-serif';
  font-size: 18px;
  line-height: 1.5;
  color: black;
  box-sizing: border-box;
  margin: 0;
} 
#wrapper {
  width: 100%;
  max-width: 600px;
  position: relative;
  margin: 0 auto;
  padding:10px;
}
.mapbox { 
  height: 400px; 
  width: 100%;
  margin-bottom: 20px;
}

.leaflet-container {
    background: #658E9C;
    font-family: 'Montserrat', 'sans-serif';
    font-size: 14px;
    line-height: 1.1;
    color: black;
}

.highlight_tooltip {
  color: #ffffff;
}

.leaflet-bottom {
	bottom: 1rem;
}
.leaflet-right {
	right: 1rem;
}

.leaflet-control-attribution{
  display: none;
}

.leaflet-tooltip{
  background-color: rgba(0,0,0,0);
  border:none ;
  box-shadow: none;
}

.leaflet-tooltip-top:before, 
.leaflet-tooltip-bottom:before, 
.leaflet-tooltip-left:before, 
.leaflet-tooltip-right:before {
    border: none !important;
}

</style>
</head>
<body>

<div id="wrapper"> 
    <div class="mapbox" id="map-container">
    </div>
</div>   

<script type="text/javascript">
var zoomlevel;
if(window.innerHeight<500){
  zoomlevel = 2;
} else if(window.innerHeight>499 && window.innerHeight<929){
  zoomlevel = 3.1;
}
else if(window.innerHeight>930){
  zoomlevel = 4;
}

var mymap = L.map('map-container',{
  zoomControl:false, 
  scrollWheelZoom:false, 
  dragging:false, 
  zoomSnap:0.1,
  doubleClickZoom: false,
}).setView([20.554522768762663, 146.42353993151968], zoomlevel); 


//Style map
function style_basemap(feature) {
    return {
        fillColor: '#CACF85',
        weight: 0.5,
        opacity: 1,
        color: '#999',
        fillOpacity: 1
    };
}

//Set up base layers
var layer_basemap = L.geoJSON(selected_countries, {
    style: style_basemap,
    onEachFeature: on_basemap,
});

//put all layers into an array (only 1 layer here)
var all_maps = {
    "basemap": layer_basemap,
};
//Preload polygon map
layer_basemap.addTo(mymap);
mymap.addLayer(layer_basemap);

//Mouseover interactions start here
var lastClicked_basemap = null;

function highlight_basemap(feature, layer) {
   
    //return the previous polygon to its original style
    if (lastClicked_basemap !== null) {
      lastClicked_basemap.setStyle({
        weight: 0.5,
        color: '#999',
        fillOpacity: 1,
        fillColor: '#CACF85',
      });
    }
    //set the style of polygon when mouseover
    this.setStyle({
        fillColor: '#8CBA80',
        weight: 1,
        color: '#fff',
        fillOpacity: 1
    });

    //This is the stypid ugly code. In a nutshell, I want to change the css class of the tooltip when I mouseover it. Here are the details:
    //Inside Leaflet, there's an option call "className" (https://leafletjs.com/reference-1.7.1.html#tooltip-classname) that allows you to add a class into the tooltip when you display the tooltip using "bindTooltip".
    //I know how to call "className" when using "bindTooltip" (see line 196). I did that for the tooltip "China".
    //What I couldn't figure it out is that how can I change the css class of the tooltip when I mouseover it.
    //I found another solution. I identified the index of each tooltip. Then I built a key:value array.
    //So I mouseover a tooltip, it would get the HTML content of the tooltip which is the country name.
    //Then I check the array for the index of that tooltip. Then I use Jquery to change the CSS of that tooltip.
    //Although this works. I still want to figure out how can I change the css class of the tooltip using Leaflet.

    var tooltip_content = this.getTooltip().getContent(); 
    var obj = {
      0: "Indonesia",
      1: "Vietnam",
      2: "South<br>Korea",
      3: "China",
      4: "Taiwan",
      5: "Philippines",
      6: "Malaysia",
      7: "Japan",
      8: "Kiribati",
    }
    var key = Object.keys(obj)[Object.values(obj).indexOf(tooltip_content)]
    $('.leaflet-tooltip:eq('+key+')').addClass('highlight_tooltip');
    
    //mouseover effects for tooltip
    this.on({
          mouseover: highlight_basemap,
          mouseout: reset_basemap,
      });
    lastClicked_basemap = this;
}

//return map to default style when mouseout
function reset_basemap(e) {
    layer_basemap.resetStyle(e.target);
    $('.leaflet-tooltip').removeClass('highlight_tooltip');
}

//Mouseover and tooltip initiation
function on_basemap(feature, layer) {
    if(feature.properties['SHOW'] == "YES"){
      //initiatve mouseover effects on the map layer
      layer.on({
          mouseover: highlight_basemap,
          mouseout: reset_basemap,
      });
      
      //Adjust the tooltip position for different countries
      if(feature.properties['NAME_EN'] == "China"){
          layer.bindTooltip(feature.properties['NAME_EN'], {'permanent':true, 'direction':'top', 'interactive':true, 'className':'highlight_tooltip'}).addTo(mymap);
      }
      else if(feature.properties['NAME_EN'] == "Indonesia") {
          layer.bindTooltip(feature.properties['NAME_EN'], {'permanent':true, 'direction':'left', 'interactive':true}).addTo(mymap);
      }
      else {
          layer.bindTooltip(feature.properties['NAME_EN'], {'permanent':true, 'direction':'center', 'interactive':true}).addTo(mymap);
      }
    }
}

</script>
</body>
</html>